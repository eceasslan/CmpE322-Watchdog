<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CMPE322 Project 1: 322-Project1/watchdog.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CMPE322 Project 1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_45847bb0d003feea36ded6ff2db14a25.html">322-Project1</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">watchdog.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The file which is executed by watchdog process.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;fstream&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;csignal&gt;</code><br />
<code>#include &lt;filesystem&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
</div>
<p><a href="watchdog_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5e6f82baf147e9ed9932a33ee00749cd"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a5e6f82baf147e9ed9932a33ee00749cd">terminate</a> (int signalNo)</td></tr>
<tr class="memdesc:a5e6f82baf147e9ed9932a33ee00749cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles SIGTERM received by the process.  <a href="watchdog_8cpp.html#a5e6f82baf147e9ed9932a33ee00749cd">More...</a><br /></td></tr>
<tr class="separator:a5e6f82baf147e9ed9932a33ee00749cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="memdesc:a0ddf1224851353fc92bfbff6f499fa97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates child processes, sleeps until one of them is killed and when it happens, creates the killed process again.  <a href="watchdog_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">More...</a><br /></td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a39533ec8e1e754a6c4a7a47531b31081"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a></td></tr>
<tr class="memdesc:a39533ec8e1e754a6c4a7a47531b31081"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the number of child processes.  <a href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">More...</a><br /></td></tr>
<tr class="separator:a39533ec8e1e754a6c4a7a47531b31081"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ca05d4637915c4df360057a60bdfc9c"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">processOPath</a></td></tr>
<tr class="memdesc:a6ca05d4637915c4df360057a60bdfc9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the path of the output file of the child processes.  <a href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">More...</a><br /></td></tr>
<tr class="separator:a6ca05d4637915c4df360057a60bdfc9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7044dc872fe451c80120ede11d1f98e8"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a7044dc872fe451c80120ede11d1f98e8">watchdogOPath</a></td></tr>
<tr class="memdesc:a7044dc872fe451c80120ede11d1f98e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the path of the output file of the watchdog process.  <a href="watchdog_8cpp.html#a7044dc872fe451c80120ede11d1f98e8">More...</a><br /></td></tr>
<tr class="separator:a7044dc872fe451c80120ede11d1f98e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4d2b40adbf7ee6ab66d1954f0c303c3"><td class="memItemLeft" align="right" valign="top"><a id="ac4d2b40adbf7ee6ab66d1954f0c303c3"></a>
ofstream&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a></td></tr>
<tr class="memdesc:ac4d2b40adbf7ee6ab66d1954f0c303c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">It is the file stream which deals with the output file of the watchdog process. <br /></td></tr>
<tr class="separator:ac4d2b40adbf7ee6ab66d1954f0c303c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1edd531d8e83bd68bb1b67f99b1ebebf"><td class="memItemLeft" align="right" valign="top"><a id="a1edd531d8e83bd68bb1b67f99b1ebebf"></a>
ofstream&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8cpp.html#a1edd531d8e83bd68bb1b67f99b1ebebf">fd2</a></td></tr>
<tr class="memdesc:a1edd531d8e83bd68bb1b67f99b1ebebf"><td class="mdescLeft">&#160;</td><td class="mdescRight">It is the file stream which deals with the output file of the child processes. <br /></td></tr>
<tr class="separator:a1edd531d8e83bd68bb1b67f99b1ebebf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32b2c07bf2f64897de048c86e709760f"><td class="memItemLeft" align="right" valign="top"><a id="a32b2c07bf2f64897de048c86e709760f"></a>
struct <a class="el" href="structtimespec.html">timespec</a>&#160;</td><td class="memItemRight" valign="bottom"><b>delta</b> = {0, 300000000}</td></tr>
<tr class="separator:a32b2c07bf2f64897de048c86e709760f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The file which is executed by watchdog process. </p>
<dl class="section author"><dt>Author</dt><dd>Ece Dilara Aslan </dd></dl>
<dl class="section date"><dt>Date</dt><dd>02.01.2021</dd></dl>
<p>First, this source file creates its child processes and write their informations into an output file and also into the pipe which is a way of communication with the executor process. Then, it sleeps until one of its children is terminated. If a child is killed, then it immediately writes which process is killed into the output file and creates it again. In the case of termination of head process, it kills the remaining child processes and then creates them.</p>
<p>I believe, the main idea of the project is to deal with process fails. We will develop larger projects and these projects will have lots of processes. In order to make sure that everything is running without any error, we need to check each process all the time. So we need to know how a watchdog process can be developed. At the end of this project, I have learned lots of information about process operations and pipe implementation, and using these operations and pipes gave me a better understanding about these topics. </p>

<p class="definition">Definition in file <a class="el" href="watchdog_8cpp_source.html">watchdog.cpp</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates child processes, sleeps until one of them is killed and when it happens, creates the killed process again. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>The number of arguments sent from command line. </td></tr>
    <tr><td class="paramname">argv</td><td>An array of arguments sent from command line. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="watchdog_8cpp_source.html#l00081">81</a> of file <a class="el" href="watchdog_8cpp_source.html">watchdog.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a> = stoi(argv[1]);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">processOPath</a> = argv[2];</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="watchdog_8cpp.html#a7044dc872fe451c80120ede11d1f98e8">watchdogOPath</a> = argv[3];</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    signal(SIGTERM, <a class="code" href="watchdog_8cpp.html#a5e6f82baf147e9ed9932a33ee00749cd">terminate</a>); <span class="comment">//when SIGTERM received, call terminate() function</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="watchdog_8cpp.html#a1edd531d8e83bd68bb1b67f99b1ebebf">fd2</a>.open(<a class="code" href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">processOPath</a>, ios::out); <span class="comment">//in order to clean up the output file of the child processes</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="watchdog_8cpp.html#a1edd531d8e83bd68bb1b67f99b1ebebf">fd2</a>.close();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a>.open(<a class="code" href="watchdog_8cpp.html#a7044dc872fe451c80120ede11d1f98e8">watchdogOPath</a>, ios::out);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    pid_t pids[<a class="code" href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a>+1];</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    pids[0] = (long)getpid();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">int</span> pipe = open(<span class="stringliteral">&quot;/tmp/myfifo&quot;</span>, O_WRONLY); <span class="comment">//opens pipe in write only mode</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordtype">char</span> temppid[30]; <span class="comment">//input buffer of pipe</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordtype">string</span> temp;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    temp = <span class="stringliteral">&quot;P0 &quot;</span> + to_string(pids[0]);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    strcpy(temppid, temp.c_str());</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    write(pipe, temppid, strlen(temppid)+1); </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1; i&lt;=<a class="code" href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a>; i++){ <span class="comment">//creates child processes</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        pid_t childpid;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        childpid = fork();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">if</span>(childpid == -1){</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            perror(<span class="stringliteral">&quot;Fork failed&quot;</span>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(childpid == 0){</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            execlp(<span class="stringliteral">&quot;./process&quot;</span>, <span class="stringliteral">&quot;./process&quot;</span>, <a class="code" href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">processOPath</a>, to_string(i).c_str(), NULL);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            pids[i] = childpid;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            temp = <span class="stringliteral">&quot;P&quot;</span> + to_string(i) + <span class="stringliteral">&quot; &quot;</span> + to_string(pids[i]);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            strcpy(temppid, temp.c_str());</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            write(pipe, temppid, strlen(temppid)+1);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;P&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; is started and it has a pid of &quot;</span> &lt;&lt; pids[i] &lt;&lt; endl;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        nanosleep(&amp;delta, &amp;delta);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">while</span>(<span class="keyword">true</span>){ <span class="comment">//being executed until receiving SIGTERM</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        pid_t terminated;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        terminated = wait(NULL); <span class="comment">//sleeps until one of the child processes is killed</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">if</span>(terminated == pids[1]){ <span class="comment">//the case of termination of the head process</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;P1 is killed, all processes must be killed&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=2; i&lt;=<a class="code" href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a>; i++){ <span class="comment">//kills all of the child processes</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                kill(pids[i], SIGTERM);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                wait(NULL);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                nanosleep(&amp;delta, &amp;delta);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;Restarting all processes&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1; i&lt;=<a class="code" href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a>; i++){ <span class="comment">//creates new child processes</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                pid_t childpid;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                childpid = fork();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">if</span>(childpid == -1){</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    perror(<span class="stringliteral">&quot;Fork failed&quot;</span>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(childpid == 0){</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                    execlp(<span class="stringliteral">&quot;./process&quot;</span>, <span class="stringliteral">&quot;./process&quot;</span>, <a class="code" href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">processOPath</a>, to_string(i).c_str(), NULL);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                    pids[i] = childpid;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                    temp = <span class="stringliteral">&quot;P&quot;</span> + to_string(i) + <span class="stringliteral">&quot; &quot;</span> + to_string(pids[i]);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                    strcpy(temppid, temp.c_str());</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    write(pipe, temppid, strlen(temppid)+1);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;P&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; is started and it has a pid of &quot;</span> &lt;&lt; pids[i] &lt;&lt; endl;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                nanosleep(&amp;delta, &amp;delta);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">else</span>{ <span class="comment">//the case of the termination of a process other than head process</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">for</span>(i=2; i&lt;=<a class="code" href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a>; i++){ <span class="comment">//finds the terminated process number</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="keywordflow">if</span>(pids[i] == terminated){</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;P&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; is killed&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;Restarting P&quot;</span> &lt;&lt; i &lt;&lt; endl;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            pid_t childpid; <span class="comment">//creates a new process for the terminated process number</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            childpid = fork();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="keywordflow">if</span>(childpid == -1){</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                perror(<span class="stringliteral">&quot;Fork failed&quot;</span>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(childpid == 0){</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                execlp(<span class="stringliteral">&quot;./process&quot;</span>, <span class="stringliteral">&quot;./process&quot;</span>, <a class="code" href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">processOPath</a>, to_string(i).c_str(), NULL);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                pids[i] = childpid;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                temp = <span class="stringliteral">&quot;P&quot;</span> + to_string(i) + <span class="stringliteral">&quot; &quot;</span> + to_string(pids[i]);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                strcpy(temppid, temp.c_str());</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                write(pipe, temppid, strlen(temppid)+1);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;P&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; is started and it has a pid of &quot;</span> &lt;&lt; pids[i] &lt;&lt; endl;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="ttc" id="awatchdog_8cpp_html_a1edd531d8e83bd68bb1b67f99b1ebebf"><div class="ttname"><a href="watchdog_8cpp.html#a1edd531d8e83bd68bb1b67f99b1ebebf">fd2</a></div><div class="ttdeci">ofstream fd2</div><div class="ttdoc">It is the file stream which deals with the output file of the child processes.</div><div class="ttdef"><b>Definition:</b> <a href="watchdog_8cpp_source.html#l00056">watchdog.cpp:56</a></div></div>
<div class="ttc" id="awatchdog_8cpp_html_a39533ec8e1e754a6c4a7a47531b31081"><div class="ttname"><a href="watchdog_8cpp.html#a39533ec8e1e754a6c4a7a47531b31081">processNumber</a></div><div class="ttdeci">int processNumber</div><div class="ttdoc">Contains the number of child processes.</div><div class="ttdef"><b>Definition:</b> <a href="watchdog_8cpp_source.html#l00036">watchdog.cpp:36</a></div></div>
<div class="ttc" id="awatchdog_8cpp_html_a5e6f82baf147e9ed9932a33ee00749cd"><div class="ttname"><a href="watchdog_8cpp.html#a5e6f82baf147e9ed9932a33ee00749cd">terminate</a></div><div class="ttdeci">static void terminate(int signalNo)</div><div class="ttdoc">Handles SIGTERM received by the process.</div><div class="ttdef"><b>Definition:</b> <a href="watchdog_8cpp_source.html#l00067">watchdog.cpp:67</a></div></div>
<div class="ttc" id="awatchdog_8cpp_html_a6ca05d4637915c4df360057a60bdfc9c"><div class="ttname"><a href="watchdog_8cpp.html#a6ca05d4637915c4df360057a60bdfc9c">processOPath</a></div><div class="ttdeci">char * processOPath</div><div class="ttdoc">Contains the path of the output file of the child processes.</div><div class="ttdef"><b>Definition:</b> <a href="watchdog_8cpp_source.html#l00042">watchdog.cpp:42</a></div></div>
<div class="ttc" id="awatchdog_8cpp_html_a7044dc872fe451c80120ede11d1f98e8"><div class="ttname"><a href="watchdog_8cpp.html#a7044dc872fe451c80120ede11d1f98e8">watchdogOPath</a></div><div class="ttdeci">char * watchdogOPath</div><div class="ttdoc">Contains the path of the output file of the watchdog process.</div><div class="ttdef"><b>Definition:</b> <a href="watchdog_8cpp_source.html#l00048">watchdog.cpp:48</a></div></div>
<div class="ttc" id="awatchdog_8cpp_html_ac4d2b40adbf7ee6ab66d1954f0c303c3"><div class="ttname"><a href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a></div><div class="ttdeci">ofstream fd</div><div class="ttdoc">It is the file stream which deals with the output file of the watchdog process.</div><div class="ttdef"><b>Definition:</b> <a href="watchdog_8cpp_source.html#l00052">watchdog.cpp:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5e6f82baf147e9ed9932a33ee00749cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e6f82baf147e9ed9932a33ee00749cd">&#9670;&nbsp;</a></span>terminate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void terminate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>signalNo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles SIGTERM received by the process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">signalNo</td><td>The value of the received signal. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="watchdog_8cpp_source.html#l00067">67</a> of file <a class="el" href="watchdog_8cpp_source.html">watchdog.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                                   {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a> &lt;&lt; <span class="stringliteral">&quot;Watchdog is terminating gracefully&quot;</span>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="watchdog_8cpp.html#ac4d2b40adbf7ee6ab66d1954f0c303c3">fd</a>.close();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    exit(0);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a39533ec8e1e754a6c4a7a47531b31081"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39533ec8e1e754a6c4a7a47531b31081">&#9670;&nbsp;</a></span>processNumber</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int processNumber</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Contains the number of child processes. </p>
<p>This data is obtained from command line arguments. </p>

<p class="definition">Definition at line <a class="el" href="watchdog_8cpp_source.html#l00036">36</a> of file <a class="el" href="watchdog_8cpp_source.html">watchdog.cpp</a>.</p>

</div>
</div>
<a id="a6ca05d4637915c4df360057a60bdfc9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ca05d4637915c4df360057a60bdfc9c">&#9670;&nbsp;</a></span>processOPath</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * processOPath</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Contains the path of the output file of the child processes. </p>
<p>This data is obtained from command line arguments. </p>

<p class="definition">Definition at line <a class="el" href="watchdog_8cpp_source.html#l00042">42</a> of file <a class="el" href="watchdog_8cpp_source.html">watchdog.cpp</a>.</p>

</div>
</div>
<a id="a7044dc872fe451c80120ede11d1f98e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7044dc872fe451c80120ede11d1f98e8">&#9670;&nbsp;</a></span>watchdogOPath</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * watchdogOPath</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Contains the path of the output file of the watchdog process. </p>
<p>This data is obtained from command line arguments. </p>

<p class="definition">Definition at line <a class="el" href="watchdog_8cpp_source.html#l00048">48</a> of file <a class="el" href="watchdog_8cpp_source.html">watchdog.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
